Анализ требование и предметной области

1. Интернет-магазин должен иметь веб-интерфейс, но он должен иметь возможность подключения через другие интерфейсы 
(веб-сервисы и т.п.)
    * Использование REST - API для получения - загрузки данных

2. Интернет-магазин предназначен для продажи книг, с оплатой заказов через интернет.
    * Использование платежного API. Paypal/other services 
    https://developer.paypal.com/docs/classic/api/adaptive-payments/Pay_API_Operation/

3. Пользователь должен иметь возможность добавить книги в онлайн корзину, после чего произвести оплату.
  * Пользователь может убрать предметы из корзины. 
		* Нужно ассоциировать сессию с каждым пользователем, сохраняя её идентификатор в куках. Никакой ценной информации сессия 
    не хранит (кроме корзины), поэтому так можно. Отсюда проблема: нужно удалять старые сессии. 
    
		* Решение: с сессией сохранять еще и время последнего использования. Можно запускать процесс - демон, который будет 
    убивать старые сессии и информацию о них.

4. Пользователь должен иметь возможность вести списки желаемых покупок, т.е. книг, которые он хочет купить позже. 
	* Тут уже не обойтись без авторизации. Если пользователь хочет вести такие списки, то придется зарегистрироваться. Т.е. 
  корзина может быть ассоциирована как с пользователем так и с сессией. Более того, она может переехать от сессии к 
  пользователю, если он всё-же создал профиль, или вошел в аккаунт.

5. Пользователь должен иметь возможность отменить заказ до того, как он отправлен по почте.
	* Необходимо поддерживать список активных заказов (заказ -> статус)

6. Пользователь должен иметь возможность оплатить заказ кредитной картой или по счету на оплату. 
	* См пункт 2

7. Должна быть возможность вернуть книги. 
	* Список активных заказов должен содержать и выполненные заказы

8. Интернет-магазин должен встраиваться на сайты партнеров в виде мини-каталога, который составляется по основному каталогу, 
хранящемуся в центральной базе данных.
	* Мини-каталог должен быть построен на основе XML для того, чтобы была возможность передавать его между системами.
		* часть REST API должна быть вынесена как внешняя (и придется закрепить интерфейс этой части API)


9. Пользователь должен иметь возможность создать учетную запись клиента, чтобы система запоминала данные пользователя 
(имя, адрес, данные банковской карты и т.д.) и восстанавливала их при входе.
	* Система должна вести основной список учетных записей в центральной базе данных. 
		* Нужно выделить сервер, который будет выполнять 

	* При входе пользователя его пароль должен сверяться с паролем в основном списке паролей, сохраненным в базе данных. 
		* Лучше пароли в строковом виде не хранить. Возможное решение - считать хеш (base64, etc) и хранить его 


10. Пользователь должен иметь возможность искать книги различными способами поиска – по заголовку, по автору, ключевому 
слову или категории и после поиска просматривать детальное описание книги. 
	* Лучшее решение - использовать что-то стороннее для поиска, т.к. искать книги внутри реляционной СУБД не очень удобно + 
  это увеличит нагрузку на СУБД. Т.к. название книги и её метаинформация не меняется, то можно воспользоваться elasticsearch, 
  индексируя лишь новые книги, и перенаправляя поисковые запросы на elasticsearch


11. Пользователь должен иметь возможность оставлять отзывы на понравившиеся книги. Оставленные отзывы должны появляться в 
детальном описании книги. Отзыв должен включать выставленный клиентом рейтинг (1-5), который должен показываться вместе с 
заголовком книги в списке книг.
  * Отзывы на книгу должны модерироваться, т.е. им должен присваиваться статус Ok кем-то из администраторов прежде, чем 
  они появятся на сайте.
	  * Решается на уровне СУБД + создание дополнительных  страниц для модерации новых отзывов
  
  * Длинные отзывы должны обрезаться при выводе детального описания книги. Клиент может щелкнуть по отзыву, чтобы просмотреть
  полный отзыв на отдельной странице.
		* Это деталь реализации как там отобразить отзыв у клиента


12. Должна быть возможность размещения администраторами редакторских отзывов. Они также должны появляться на странице с 
детальным описанием книги. 
	* Решается на уровне SQL дополнительным флагом, что отзыв редакторский


13. Интернет-магазин должен позволять сторонним продавцам (например, магазинам подержанных книг) добавлять свои каталоги 
книг в основной каталог книг, так чтобы книги этих продавцов присутствовали в результатах поиска. 
	* Стоит подумать о том, чтобы поиск мог не включать такие книги, либо искать только по ним.


14. Интернет-магазин должен быть масштабируем со следующими требованиями:
  * Должна быть возможность управлять до 100 тыс. учетных записей пользователей за первые 6 месяцев работы и затем до 1 
  млн. пользователей.
    * Добавим нужные индексы в СУБД. Вероятно, пригодится индекс у пользователей по логину/почте, индексы в заказах 
    пользователя по id пользователя

  * Должна быть возможность обслуживать одновременно 1000 посетителей (до 10000 тысяч после 6 месяцев)
		* Возможное узкое место - центральный сервер. Но один сервер справляется с такой нагрузкой

  * Система должна обслуживать 100 поисковых запросов в минуту (1 тыс./мин. после 6 месяцев)
    * elasticsearch невероятно мощная и масштабируемая штука. Если на ней работает поиск в github, то в магазине книжек 
    его будет достаточно.

  * Система должна обслуживать 100 покупок в час (1 тыс./час после 6 мес.)
    * Вопрос скорее к платежным сервисам. У них есть возможность обработать такое количество запросов.


Таким образом, сервис можно разбить на несколько частей:

* сервис с пользователями и сессиями
* сервис книгами и отзывами
* сервис поиска
* сервис заказов
* сервис платежей
* сервис сессий

